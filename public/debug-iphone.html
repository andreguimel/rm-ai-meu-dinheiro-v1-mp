<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug iPhone - Meu Dinheiro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .status {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .status.error {
            background: #ffeaea;
            border-color: #f44336;
        }
        
        .status.warning {
            background: #fff3cd;
            border-color: #ffc107;
        }
        
        .info-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .info-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #007bff;
        }
        
        .info-label {
            font-weight: bold;
            color: #333;
            font-size: 14px;
        }
        
        .info-value {
            color: #666;
            font-size: 13px;
            word-break: break-all;
        }
        
        .test-results {
            margin-bottom: 30px;
        }
        
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 8px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .test-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .test-status.success {
            background: #d4edda;
            color: #155724;
        }
        
        .test-status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .actions {
            display: grid;
            gap: 10px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            display: block;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .logs {
            margin-top: 20px;
            background: #f8f9fa;
            border-radius: 6px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .log-error { color: #dc3545; }
        .log-warning { color: #ffc107; }
        .log-info { color: #17a2b8; }
        .log-success { color: #28a745; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîç Debug iPhone</h1>
            <p>Diagn√≥stico da Tela Branca</p>
        </div>
        
        <div id="status" class="status">
            <strong>Status:</strong> Iniciando diagn√≥stico...
        </div>
        
        <div class="info-grid">
            <div class="info-item">
                <div class="info-label">User Agent:</div>
                <div class="info-value" id="userAgent">Carregando...</div>
            </div>
            <div class="info-item">
                <div class="info-label">Viewport:</div>
                <div class="info-value" id="viewport">Carregando...</div>
            </div>
            <div class="info-item">
                <div class="info-label">URL Atual:</div>
                <div class="info-value" id="currentUrl">Carregando...</div>
            </div>
            <div class="info-item">
                <div class="info-label">Timestamp:</div>
                <div class="info-value" id="timestamp">Carregando...</div>
            </div>
        </div>
        
        <div class="test-results">
            <h3>Testes de Compatibilidade:</h3>
            <div class="test-item">
                <span>localStorage</span>
                <span id="test-localStorage" class="test-status">Testando...</span>
            </div>
            <div class="test-item">
                <span>sessionStorage</span>
                <span id="test-sessionStorage" class="test-status">Testando...</span>
            </div>
            <div class="test-item">
                <span>fetch API</span>
                <span id="test-fetch" class="test-status">Testando...</span>
            </div>
            <div class="test-item">
                <span>ES6 Modules</span>
                <span id="test-modules" class="test-status">Testando...</span>
            </div>
            <div class="test-item">
                <span>CSS Grid</span>
                <span id="test-grid" class="test-status">Testando...</span>
            </div>
        </div>
        
        <div class="actions">
            <a href="/dashboard" class="btn btn-primary">üè† Tentar Dashboard</a>
            <a href="/" class="btn btn-secondary">üè† Voltar ao In√≠cio</a>
            <button onclick="runFullDiagnostic()" class="btn btn-success">üîÑ Executar Diagn√≥stico Completo</button>
        </div>
        
        <div class="logs" id="logs">
            <div class="log-entry log-info">Iniciando diagn√≥stico...</div>
        </div>
    </div>

    <script>
        // Fun√ß√£o para adicionar logs
        function addLog(type, message, data = null) {
            const logs = document.getElementById('logs');
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            let logMessage = `[${timestamp}] ${message}`;
            
            if (data) {
                logMessage += ` | Data: ${JSON.stringify(data)}`;
            }
            
            entry.textContent = logMessage;
            logs.appendChild(entry);
            logs.scrollTop = logs.scrollHeight;
            
            console.log(`[iPhone Debug] ${logMessage}`);
        }
        
        // Fun√ß√£o para atualizar status do teste
        function updateTestStatus(testId, success, message = '') {
            const element = document.getElementById(`test-${testId}`);
            if (success) {
                element.className = 'test-status success';
                element.textContent = 'OK';
            } else {
                element.className = 'test-status error';
                element.textContent = 'ERRO';
            }
            
            if (message) {
                addLog(success ? 'success' : 'error', `${testId}: ${message}`);
            }
        }
        
        // Fun√ß√£o para atualizar status geral
        function updateStatus(message, type = 'info') {
            const status = document.getElementById('status');
            status.className = `status ${type}`;
            status.innerHTML = `<strong>Status:</strong> ${message}`;
        }
        
        // Carregar informa√ß√µes b√°sicas
        function loadBasicInfo() {
            try {
                document.getElementById('userAgent').textContent = navigator.userAgent;
                document.getElementById('viewport').textContent = `${window.innerWidth}x${window.innerHeight}`;
                document.getElementById('currentUrl').textContent = window.location.href;
                document.getElementById('timestamp').textContent = new Date().toLocaleString();
                
                addLog('info', 'Informa√ß√µes b√°sicas carregadas');
            } catch (error) {
                addLog('error', 'Erro ao carregar informa√ß√µes b√°sicas', error.message);
            }
        }
        
        // Testar localStorage
        function testLocalStorage() {
            try {
                const testKey = 'iphone-debug-test';
                localStorage.setItem(testKey, 'test-value');
                const value = localStorage.getItem(testKey);
                localStorage.removeItem(testKey);
                
                updateTestStatus('localStorage', value === 'test-value', 'localStorage funcionando');
            } catch (error) {
                updateTestStatus('localStorage', false, `Erro: ${error.message}`);
            }
        }
        
        // Testar sessionStorage
        function testSessionStorage() {
            try {
                const testKey = 'iphone-debug-session-test';
                sessionStorage.setItem(testKey, 'test-value');
                const value = sessionStorage.getItem(testKey);
                sessionStorage.removeItem(testKey);
                
                updateTestStatus('sessionStorage', value === 'test-value', 'sessionStorage funcionando');
            } catch (error) {
                updateTestStatus('sessionStorage', false, `Erro: ${error.message}`);
            }
        }
        
        // Testar fetch API
        function testFetch() {
            try {
                if (typeof fetch !== 'undefined') {
                    updateTestStatus('fetch', true, 'fetch API dispon√≠vel');
                } else {
                    updateTestStatus('fetch', false, 'fetch API n√£o dispon√≠vel');
                }
            } catch (error) {
                updateTestStatus('fetch', false, `Erro: ${error.message}`);
            }
        }
        
        // Testar ES6 Modules
        function testModules() {
            try {
                const supportsModules = 'noModule' in HTMLScriptElement.prototype;
                updateTestStatus('modules', supportsModules, supportsModules ? 'ES6 Modules suportados' : 'ES6 Modules n√£o suportados');
            } catch (error) {
                updateTestStatus('modules', false, `Erro: ${error.message}`);
            }
        }
        
        // Testar CSS Grid
        function testCSSGrid() {
            try {
                const supportsGrid = CSS.supports('display', 'grid');
                updateTestStatus('grid', supportsGrid, supportsGrid ? 'CSS Grid suportado' : 'CSS Grid n√£o suportado');
            } catch (error) {
                updateTestStatus('grid', false, `Erro: ${error.message}`);
            }
        }
        
        // Executar diagn√≥stico completo
        function runFullDiagnostic() {
            addLog('info', 'Iniciando diagn√≥stico completo...');
            updateStatus('Executando diagn√≥stico completo...', 'warning');
            
            setTimeout(() => {
                loadBasicInfo();
                testLocalStorage();
                testSessionStorage();
                testFetch();
                testModules();
                testCSSGrid();
                
                updateStatus('Diagn√≥stico conclu√≠do! Verifique os resultados acima.', 'success');
                addLog('success', 'Diagn√≥stico completo finalizado');
            }, 500);
        }
        
        // Capturar erros globais
        window.addEventListener('error', function(event) {
            addLog('error', 'Erro JavaScript capturado', {
                message: event.message,
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno
            });
        });
        
        // Capturar erros de Promise rejeitadas
        window.addEventListener('unhandledrejection', function(event) {
            addLog('error', 'Promise rejeitada capturada', event.reason);
        });
        
        // Executar diagn√≥stico inicial
        document.addEventListener('DOMContentLoaded', function() {
            addLog('info', 'DOM carregado, iniciando diagn√≥stico...');
            runFullDiagnostic();
        });
        
        // Detectar se √© iPhone
        const isIPhone = /iPhone/i.test(navigator.userAgent);
        if (isIPhone) {
            addLog('info', 'iPhone detectado!');
            updateStatus('iPhone detectado - executando testes espec√≠ficos...', 'warning');
        } else {
            addLog('warning', 'N√£o √© um iPhone - alguns testes podem n√£o ser relevantes');
        }
    </script>
</body>
</html>