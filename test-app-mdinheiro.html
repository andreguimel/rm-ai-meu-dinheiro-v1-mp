<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste mdinheiro.com.br - Diagn√≥stico</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        #console {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üîç Diagn√≥stico mdinheiro.com.br</h1>
    
    <div class="test-section">
        <h2>üìä Informa√ß√µes do Ambiente</h2>
        <div id="env-info"></div>
    </div>
    
    <div class="test-section">
        <h2>üåê Testes de Conectividade</h2>
        <button onclick="testMainApp()">Testar Aplica√ß√£o Principal</button>
        <button onclick="testSupabase()">Testar Supabase</button>
        <button onclick="testCORS()">Testar CORS</button>
        <div id="connectivity-results"></div>
    </div>
    
    <div class="test-section">
        <h2>üîê Teste de Login</h2>
        <p>Este teste simula o processo de login para identificar onde ocorre o problema:</p>
        <button onclick="testLoginFlow()">Simular Fluxo de Login</button>
        <div id="login-results"></div>
    </div>
    
    <div class="test-section">
        <h2>üì± Teste Espec√≠fico iPhone</h2>
        <p>Testes espec√≠ficos para problemas do iPhone:</p>
        <button onclick="testIPhoneIssues()">Testar Problemas iPhone</button>
        <div id="iphone-results"></div>
    </div>
    
    <div class="test-section">
        <h2>üìù Console de Debug</h2>
        <div id="console"></div>
        <button onclick="clearConsole()">Limpar Console</button>
    </div>

    <script>
        // Fun√ß√£o para log no console personalizado
        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#0f0',
                error: '#f00',
                warning: '#ff0',
                success: '#0f0'
            };
            console.innerHTML += `<span style="color: ${colors[type]}">[${timestamp}] ${message}</span>\n`;
            console.scrollTop = console.scrollHeight;
        }
        
        function clearConsole() {
            document.getElementById('console').innerHTML = '';
        }
        
        // Mostrar informa√ß√µes do ambiente
        function showEnvInfo() {
            const info = {
                'User Agent': navigator.userAgent,
                'URL Atual': window.location.href,
                'Protocolo': window.location.protocol,
                'Host': window.location.host,
                'Cookies Habilitados': navigator.cookieEnabled,
                'JavaScript Habilitado': true,
                'Local Storage': typeof(Storage) !== "undefined",
                'Viewport': `${window.innerWidth}x${window.innerHeight}`
            };
            
            let html = '';
            for (const [key, value] of Object.entries(info)) {
                html += `<strong>${key}:</strong> ${value}<br>`;
            }
            
            document.getElementById('env-info').innerHTML = html;
            log('Informa√ß√µes do ambiente carregadas', 'info');
        }
        
        // Testar aplica√ß√£o principal
        async function testMainApp() {
            log('Testando aplica√ß√£o principal...', 'info');
            const results = document.getElementById('connectivity-results');
            
            try {
                const response = await fetch('https://mdinheiro.com.br/', {
                    method: 'GET',
                    mode: 'cors'
                });
                
                if (response.ok) {
                    const text = await response.text();
                    const hasReact = text.includes('react') || text.includes('React');
                    const hasVite = text.includes('vite') || text.includes('Vite');
                    
                    results.innerHTML += `<div class="status success">‚úÖ Aplica√ß√£o carregou (${response.status})<br>React detectado: ${hasReact}<br>Vite detectado: ${hasVite}</div>`;
                    log(`Aplica√ß√£o OK - React: ${hasReact}, Vite: ${hasVite}`, 'success');
                } else {
                    results.innerHTML += `<div class="status error">‚ùå Erro HTTP: ${response.status}</div>`;
                    log(`Erro HTTP: ${response.status}`, 'error');
                }
            } catch (error) {
                results.innerHTML += `<div class="status error">‚ùå Erro de rede: ${error.message}</div>`;
                log(`Erro de rede: ${error.message}`, 'error');
            }
        }
        
        // Testar Supabase
        async function testSupabase() {
            log('Testando conectividade Supabase...', 'info');
            const results = document.getElementById('connectivity-results');
            
            try {
                const response = await fetch('https://ponxumxwjodpgwhepwxc.supabase.co/rest/v1/', {
                    headers: {
                        'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBvbnh1bXh3am9kcGd3aGVwd3hjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0NTE4NTIsImV4cCI6MjA3MTAyNzg1Mn0.J43LGwbU8tQ8_xe3ua4ddb-HTFLsWXoR7R1MVIS3SdE'
                    }
                });
                
                if (response.ok) {
                    results.innerHTML += `<div class="status success">‚úÖ Supabase conectado (${response.status})</div>`;
                    log('Supabase OK', 'success');
                } else {
                    results.innerHTML += `<div class="status error">‚ùå Supabase erro: ${response.status}</div>`;
                    log(`Supabase erro: ${response.status}`, 'error');
                }
            } catch (error) {
                results.innerHTML += `<div class="status error">‚ùå Supabase n√£o acess√≠vel: ${error.message}</div>`;
                log(`Supabase erro: ${error.message}`, 'error');
            }
        }
        
        // Testar CORS
        async function testCORS() {
            log('Testando CORS...', 'info');
            const results = document.getElementById('connectivity-results');
            
            try {
                const response = await fetch('https://mdinheiro.com.br/', {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': 'https://mdinheiro.com.br',
                        'Access-Control-Request-Method': 'POST'
                    }
                });
                
                results.innerHTML += `<div class="status success">‚úÖ CORS OK (${response.status})</div>`;
                log('CORS OK', 'success');
            } catch (error) {
                results.innerHTML += `<div class="status error">‚ùå CORS problema: ${error.message}</div>`;
                log(`CORS erro: ${error.message}`, 'error');
            }
        }
        
        // Simular fluxo de login
        async function testLoginFlow() {
            log('Simulando fluxo de login...', 'info');
            const results = document.getElementById('login-results');
            results.innerHTML = '<div class="status warning">üîÑ Testando fluxo de login...</div>';
            
            // Simular carregamento da p√°gina de login
            try {
                log('1. Carregando p√°gina de login...', 'info');
                const loginPage = await fetch('https://mdinheiro.com.br/login', { mode: 'cors' });
                
                if (loginPage.ok) {
                    log('2. P√°gina de login carregada com sucesso', 'success');
                    
                    // Simular tentativa de autentica√ß√£o
                    log('3. Testando endpoint de autentica√ß√£o...', 'info');
                    
                    try {
                        const authTest = await fetch('https://ponxumxwjodpgwhepwxc.supabase.co/auth/v1/token?grant_type=password', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBvbnh1bXh3am9kcGd3aGVwd3hjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU0NTE4NTIsImV4cCI6MjA3MTAyNzg1Mn0.J43LGwbU8tQ8_xe3ua4ddb-HTFLsWXoR7R1MVIS3SdE'
                            },
                            body: JSON.stringify({
                                email: 'test@test.com',
                                password: 'testpassword'
                            })
                        });
                        
                        log(`4. Resposta de autentica√ß√£o: ${authTest.status}`, authTest.status === 400 ? 'warning' : 'info');
                        
                        results.innerHTML = `
                            <div class="status success">‚úÖ P√°gina de login: OK</div>
                            <div class="status ${authTest.status === 400 ? 'warning' : 'success'}">üì° Endpoint auth: ${authTest.status} (esperado 400 para credenciais inv√°lidas)</div>
                        `;
                        
                    } catch (authError) {
                        log(`Erro na autentica√ß√£o: ${authError.message}`, 'error');
                        results.innerHTML += `<div class="status error">‚ùå Problema na autentica√ß√£o: ${authError.message}</div>`;
                    }
                    
                } else {
                    log(`Erro ao carregar login: ${loginPage.status}`, 'error');
                    results.innerHTML = `<div class="status error">‚ùå P√°gina de login n√£o carregou: ${loginPage.status}</div>`;
                }
                
            } catch (error) {
                log(`Erro no fluxo de login: ${error.message}`, 'error');
                results.innerHTML = `<div class="status error">‚ùå Erro no fluxo: ${error.message}</div>`;
            }
        }
        
        // Testar problemas espec√≠ficos do iPhone
        function testIPhoneIssues() {
            log('Testando problemas espec√≠ficos do iPhone...', 'info');
            const results = document.getElementById('iphone-results');
            
            const isIPhone = /iPhone/.test(navigator.userAgent);
            const isSafari = /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            
            let html = `
                <div class="status ${isIPhone ? 'warning' : 'info'}">üì± iPhone detectado: ${isIPhone}</div>
                <div class="status ${isSafari ? 'warning' : 'info'}">üåê Safari detectado: ${isSafari}</div>
                <div class="status ${isIOS ? 'warning' : 'info'}">üçé iOS detectado: ${isIOS}</div>
            `;
            
            // Testar WebSocket (problema comum no iPhone)
            try {
                const ws = new WebSocket('wss://echo.websocket.org');
                ws.onopen = () => {
                    html += '<div class="status success">‚úÖ WebSocket funciona</div>';
                    results.innerHTML = html;
                    ws.close();
                    log('WebSocket OK', 'success');
                };
                ws.onerror = () => {
                    html += '<div class="status error">‚ùå WebSocket com problema</div>';
                    results.innerHTML = html;
                    log('WebSocket com problema', 'error');
                };
            } catch (error) {
                html += `<div class="status error">‚ùå WebSocket n√£o suportado: ${error.message}</div>`;
                log(`WebSocket erro: ${error.message}`, 'error');
            }
            
            // Testar Local Storage
            try {
                localStorage.setItem('test', 'value');
                localStorage.removeItem('test');
                html += '<div class="status success">‚úÖ Local Storage funciona</div>';
                log('Local Storage OK', 'success');
            } catch (error) {
                html += `<div class="status error">‚ùå Local Storage problema: ${error.message}</div>`;
                log(`Local Storage erro: ${error.message}`, 'error');
            }
            
            results.innerHTML = html;
        }
        
        // Inicializar p√°gina
        window.onload = function() {
            showEnvInfo();
            log('P√°gina de diagn√≥stico carregada', 'success');
            
            if (/iPhone/.test(navigator.userAgent)) {
                log('iPhone detectado - executando testes autom√°ticos', 'warning');
                setTimeout(testIPhoneIssues, 1000);
            }
        };
        
        // Capturar erros JavaScript
        window.onerror = function(msg, url, line, col, error) {
            log(`ERRO JS: ${msg} em ${url}:${line}:${col}`, 'error');
            return false;
        };
        
        // Capturar erros de Promise
        window.addEventListener('unhandledrejection', function(event) {
            log(`PROMISE REJEITADA: ${event.reason}`, 'error');
        });
    </script>
</body>
</html>